{
  "91": "SELECT CASE WHEN (SELECT AVG(unemployment_ratio) FROM unemployment WHERE year=1995)>(SELECT AVG(unemployment_ratio) FROM unemployment WHERE year=1996) THEN '1995' WHEN (SELECT AVG(unemployment_ratio) FROM unemployment WHERE year=1995)<(SELECT AVG(unemployment_ratio) FROM unemployment WHERE year=1996) THEN '1996' ELSE 'equal' END AS higher_year, (SELECT AVG(unemployment_ratio) FROM unemployment WHERE year=1995) AS avg_1995, (SELECT AVG(unemployment_ratio) FROM unemployment WHERE year=1996) AS avg_1996;\tfinancial",
  "96": "SELECT COUNT(*) FROM customers WHERE lower(statement_frequency) LIKE '%weekly%' AND lower(ownership)='owner';\tfinancial",
  "101": "SELECT a.* FROM accounts a JOIN trades t ON a.account_id = t.account_id WHERE date(t.trading_date) = (SELECT MIN(date(t2.trading_date)) FROM trades t2 WHERE date(t2.trading_date) BETWEEN '1995-01-01' AND '1995-12-31');\tfinancial",
  "108": "SELECT t.amount FROM transactions t JOIN accounts a ON t.account_id=a.id WHERE a.client_id=(SELECT l.client_id FROM loans l WHERE l.amount=(SELECT MAX(amount) FROM loans) LIMIT 1) AND t.transaction_date> a.opened_date ORDER BY t.transaction_date ASC LIMIT 1;\tfinancial",
  "117": "SELECT ROUND(100.0 * SUM(CASE WHEN loan_status = 'Fully Paid' THEN loan_amnt ELSE 0 END) / NULLIF(SUM(loan_amnt),0),2) AS percent_fully_paid_no_issue FROM loans;\tfinancial",
  "128": "SELECT district, COUNT(*) AS female_count FROM account_holders WHERE LOWER(gender) IN ('female','f') GROUP BY district ORDER BY female_count DESC LIMIT 9;\tfinancial",
  "136": "SELECT COUNT(*) FROM loans l JOIN accounts a ON l.account_id = a.id WHERE l.amount >= 250000 AND a.statement_issuance = 'Monthly' AND l.approval_date BETWEEN '1995-01-01' AND '1997-12-31';\tfinancial",
  "149": "SELECT DISTINCT at.name, d.avg_income FROM account_types at JOIN accounts a ON a.account_type_id = at.id JOIN (SELECT district_id, AVG(income) AS avg_income FROM residents GROUP BY district_id) d ON d.district_id = a.district_id WHERE at.eligible_for_loan = 0 AND d.avg_income > 8000 AND d.avg_income <= 9000;\tfinancial",
  "169": "SELECT (SUM(CASE WHEN year=1997 THEN amount ELSE 0 END)*1.0 - SUM(CASE WHEN year=1996 THEN amount ELSE 0 END)*1.0)/NULLIF(SUM(CASE WHEN year=1996 THEN amount ELSE 0 END),0) AS growth_rate FROM loans JOIN clients ON loans.client_id=clients.id WHERE clients.gender IN ('Male','M');\tfinancial",
  "173": "SELECT (SELECT COUNT(*) FROM account_statement_requests WHERE account_id=3 AND request_type='release') AS release_requests_count, (SELECT purpose FROM ledger_entries WHERE debit_account=3539 GROUP BY purpose ORDER BY SUM(amount) DESC LIMIT 1) AS debit_3539_aim, (SELECT SUM(amount) FROM ledger_entries WHERE debit_account=3539) AS debit_3539_total;\tfinancial",
  "393": "SELECT COUNT(DISTINCT c.id) FROM cards c JOIN prints p ON p.card_id = c.id WHERE c.designer = 'John Avon' AND p.is_foil = 1 AND p.is_powerful = 0;\tcard_games",
  "394": "SELECT COUNT(*) FROM cards WHERE border='white' AND powerful=1;\tcard_games",
  "406": "SELECT DISTINCT c.id FROM cards c JOIN legalities l ON c.id = l.card_id WHERE LOWER(c.type) LIKE '%creature%';\tcard_games",
  "411": "SELECT artist FROM cards WHERE text = 'Das perfekte Gegenmittel zu einer dichten Formation' LIMIT 1;\tcard_games",
  "427": "SELECT DISTINCT l.name FROM languages l JOIN set_languages sl ON sl.language_id = l.id JOIN sets s ON s.id = sl.set_id WHERE s.name='Archenemy' AND s.code='ARC';\tcard_games",
  "432": "SELECT s.name, COUNT(*) AS card_count FROM sets s JOIN cards c ON c.set_id = s.id WHERE s.language='Russian' GROUP BY s.id, s.name ORDER BY card_count DESC LIMIT 1;\tcard_games",
  "434": "SELECT COUNT(*) FROM sets s WHERE NOT EXISTS(SELECT 1 FROM mtgo_sets m WHERE m.set_id=s.id) AND (SELECT COUNT(*) FROM set_languages sl WHERE sl.set_id=s.id)=1 AND EXISTS(SELECT 1 FROM set_languages sl2 WHERE sl2.set_id=s.id AND (sl2.language='Japanese' OR sl2.lang='Japanese' OR sl2.lang='ja' OR sl2.locale='ja' OR sl2.code='ja'));\tcard_games",
  "477": "SELECT DISTINCT artist FROM cards WHERE \"set\" = 'Coldsnap' AND artist IN ('Jeremy Jarvis','Aaron Miller','Chippy');\tcard_games",
  "507": "SELECT CASE WHEN COUNT(*)=0 THEN 0 ELSE 100.0*SUM(only_online)/COUNT(*) END AS percentage FROM (SELECT c.id, CASE WHEN COALESCE(c.online_only,0)=1 THEN 1 ELSE 0 END AS only_online FROM cards c JOIN translations t ON t.card_id=c.id JOIN languages l ON l.id=t.language_id WHERE (l.name='Portuguese (Brazil)' OR l.name='Portuguese - Brazil' OR (l.name LIKE '%Portuguese%' AND l.name LIKE '%Brazil%') OR l.code IN ('pt-BR','pt_BR','ptbr','pt')) GROUP BY c.id);\tcard_games",
  "513": "SELECT id FROM sets WHERE set_type = 'commander' ORDER BY card_count DESC LIMIT 1;\tcard_games",
  "547": "SELECT COUNT(*) FROM posts p JOIN users u ON p.owner_user_id = u.id WHERE u.age >= 60 AND p.score > 19;\tcodebase_community",
  "550": "SELECT p.Body FROM Posts p JOIN Tags t ON t.ExcerptPostId = p.Id WHERE t.Count = (SELECT MAX(Count) FROM Tags);\tcodebase_community",
  "556": "SELECT AVG(badge_count) FROM (SELECT u.Id AS user_id, COUNT(b.Id) AS badge_count FROM Users u LEFT JOIN Badges b ON b.UserId = u.Id WHERE u.Views > 200 GROUP BY u.Id) AS t;\tcodebase_community",
  "558": "SELECT COUNT(*) FROM votes WHERE user_id = 58 AND date(created_at) = '2010-07-19';\tcodebase_community",
  "572": "SELECT views FROM posts WHERE title = 'Integration of Weka and/or RapidMiner into Informatica PowerCenter/Developer';\tcodebase_community",
  "578": "SELECT DISTINCT u.DisplayName, u.Reputation FROM Posts p JOIN Users u ON p.OwnerUserId = u.Id WHERE p.Title = 'Understanding what Dassault iSight is doing?';\tcodebase_community",
  "587": "SELECT p.title, c.comment, AVG(v.view_count) AS avg_views FROM posts p JOIN post_tags pt ON pt.post_id = p.id JOIN tags t ON t.id = pt.tag_id LEFT JOIN views v ON v.post_id = p.id LEFT JOIN comments c ON c.post_id = p.id WHERE t.name = 'humor' GROUP BY p.id, p.title, c.comment;\tcodebase_community",
  "598": "SELECT CASE WHEN c2010=0 THEN NULL ELSE ROUND((c2011 - c2010)*100.0 / c2010,2) END AS percent_difference FROM (SELECT SUM(CASE WHEN strftime('%Y', b.created_at)='2010' THEN 1 ELSE 0 END) AS c2010, SUM(CASE WHEN strftime('%Y', b.created_at)='2011' THEN 1 ELSE 0 END) AS c2011 FROM badges b JOIN users u ON b.user_id = u.id WHERE u.type = 'student');\tcodebase_community",
  "639": "SELECT CASE WHEN COUNT(*)=0 THEN 0 ELSE 100.0 * SUM(CASE WHEN language='R' THEN 1 ELSE 0 END)/COUNT(*) END AS percentage FROM posts WHERE owner_display_name='Community';\tcodebase_community",
  "701": "SELECT CASE WHEN total=0 THEN 0 ELSE 100.0*above/total END AS percentage FROM (SELECT (SELECT COUNT(*) FROM Posts p WHERE p.OwnerUserId=(SELECT Id FROM Users ORDER BY Reputation DESC LIMIT 1) AND p.Score>50) AS above, (SELECT COUNT(*) FROM Posts p WHERE p.OwnerUserId=(SELECT Id FROM Users ORDER BY Reputation DESC LIMIT 1)) AS total);\tcodebase_community",
  "789": "SELECT AVG(weight) FROM heroes WHERE is_alien=1;\tsuperhero",
  "793": "SELECT COUNT(*) FROM superheroes WHERE lower(race)='god/eternal' AND lower(gender)='male';\tsuperhero",
  "795": "SELECT COUNT(*) FROM superheroes WHERE LOWER(alignment)='neutral';\tsuperhero",
  "806": "SELECT eye_color FROM superheroes WHERE full_name = 'Karen Beecher-Duncan';\tsuperhero",
  "814": "SELECT DISTINCT COALESCE(s.skin_color,s.skin_colour) AS skin_colour FROM superheroes s JOIN attributes a ON s.id = a.superhero_id WHERE a.value = 100;\tsuperhero",
  "817": "SELECT race FROM superheroes WHERE hair_color='blue' AND gender='male';\tsuperhero",
  "823": "SELECT COUNT(*) FROM characters WHERE LOWER(gender) IN ('female','f','fem') AND LOWER(publisher) LIKE '%marvel%';\tsuperhero",
  "829": "SELECT CASE WHEN dc_count>marvel_count THEN 'DC' WHEN dc_count<marvel_count THEN 'Marvel Comics' ELSE 'Tie' END AS winner, ABS(dc_count-marvel_count) AS difference FROM (SELECT SUM(CASE WHEN publisher LIKE 'DC%' THEN 1 ELSE 0 END) AS dc_count, SUM(CASE WHEN publisher LIKE 'Marvel%' THEN 1 ELSE 0 END) AS marvel_count FROM characters);\tsuperhero",
  "834": "SELECT COALESCE(ROUND(100.0 * COUNT(CASE WHEN lower(gender)='female' THEN 1 END) / NULLIF(COUNT(*),0),2),0) AS percentage FROM superheroes WHERE lower(creator)='george lucas';\tsuperhero",
  "835": "SELECT 100.0 * SUM(CASE WHEN alignment='good' THEN 1 ELSE 0 END) / COUNT(*) AS percentage FROM characters WHERE publisher='Marvel Comics';\tsuperhero",
  "1470": "SELECT COUNT(DISTINCT s.id) AS count FROM stations s WHERE s.country = 'CZE' AND EXISTS (SELECT 1 FROM fuels f WHERE f.station_id = s.id AND f.name = 'Premium');\tdebit_card_specializing",
  "1476": "SELECT ((SELECT COALESCE(SUM(c.amount),0) FROM consumption c JOIN customers cu ON c.customer_id=cu.id WHERE cu.currency='CZK' AND strftime('%Y', c.date)='2012') - (SELECT COALESCE(SUM(c2.amount),0) FROM consumption c2 JOIN customers cu2 ON c2.customer_id=cu2.id WHERE cu2.currency='EUR' AND strftime('%Y', c2.date)='2012')) AS gas_consumption_difference;\tdebit_card_specializing",
  "1477": "SELECT year FROM energy GROUP BY year ORDER BY SUM(gas_use_paid_eur) DESC LIMIT 1;\tdebit_card_specializing",
  "1478": "SELECT segment FROM segments GROUP BY segment ORDER BY SUM(consumption) ASC LIMIT 1;\tdebit_card_specializing",
  "1486": "SELECT CASE WHEN czk>eur THEN 'yes' ELSE 'no' END AS more_in_czk, (czk-eur) AS more_count FROM (SELECT (SELECT COUNT(DISTINCT id) FROM customers WHERE (customer_type='SME' OR type='SME') AND currency IN ('CZK','Czech koruna','Czech_Koruna')) AS czk, (SELECT COUNT(DISTINCT id) FROM customers WHERE (customer_type='SME' OR type='SME') AND currency IN ('EUR','Euro','â‚¬')) AS eur);\tdebit_card_specializing",
  "1490": "SELECT 100.0*SUM(CASE WHEN consumption>46.73 THEN 1 ELSE 0 END)/COUNT(*) AS percent FROM customers WHERE region='LAM';\tdebit_card_specializing",
  "1501": "SELECT DISTINCT g.country FROM gas_stations g JOIN transactions t ON g.id = t.gas_station_id WHERE t.transaction_date >= '2013-06-01' AND t.transaction_date < '2013-07-01';\tdebit_card_specializing",
  "1516": "SELECT COUNT(*) FROM transactions WHERE currency='CZK' AND strftime('%Y-%m-%d',paid_at)='2012-08-26' AND strftime('%H',paid_at) BETWEEN '00' AND '11';\tdebit_card_specializing",
  "1526": "SELECT p.customer_id, (c2012.consumption - c2013.consumption) / CASE WHEN c2012.consumption=0 THEN NULL ELSE c2012.consumption END AS decrease_rate FROM payments p JOIN consumption c2012 ON p.customer_id = c2012.customer_id AND c2012.year = 2012 JOIN consumption c2013 ON p.customer_id = c2013.customer_id AND c2013.year = 2013 WHERE p.amount = 634.8 AND (p.payment_date = '2012-08-25' OR p.payment_date = '2012/8/25' OR p.payment_date = '2012-8-25');\tdebit_card_specializing",
  "1531": "WITH cust_stats AS (SELECT c.id AS customer_id, COALESCE(c.name,c.full_name,c.email) AS customer_name, SUM(oi.quantity * COALESCE(oi.unit_price,p.price,oi.price,0)) AS total_spent, SUM(oi.quantity) AS total_qty FROM customers c JOIN orders o ON o.customer_id = c.id JOIN order_items oi ON oi.order_id = o.id LEFT JOIN products p ON p.id = oi.product_id GROUP BY c.id), cust_currency AS (SELECT c.id AS customer_id, o.currency, SUM(oi.quantity * COALESCE(oi.unit_price,p.price,oi.price,0)) AS spent FROM customers c JOIN orders o ON o.customer_id = c.id JOIN order_items oi ON oi.order_id = o.id LEFT JOIN products p ON p.id = oi.product_id GROUP BY c.id,o.currency), top_customer AS (SELECT customer_id, customer_name, total_spent, total_qty FROM cust_stats ORDER BY total_spent DESC LIMIT 1), currency_choice AS (SELECT currency FROM cust_currency cc JOIN top_customer tc ON cc.customer_id = tc.customer_id ORDER BY cc.spent DESC LIMIT 1) SELECT tc.customer_name AS top_customer, tc.total_spent AS total_spent, CASE WHEN tc.total_qty>0 THEN tc.total_spent / tc.total_qty ELSE NULL END AS avg_price_per_item, (SELECT currency FROM currency_choice) AS currency FROM top_customer tc;\tdebit_card_specializing"
}